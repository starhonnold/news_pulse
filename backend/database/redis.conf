# Redis configuration for News Pulse application
# Оптимизировано для кеширования новостей

# NETWORK
bind 0.0.0.0
port 6379
timeout 300
tcp-keepalive 60

# MEMORY MANAGEMENT
maxmemory 256mb
maxmemory-policy allkeys-lru            # Удаляем старые ключи при нехватке памяти
maxmemory-samples 5

# PERSISTENCE (отключаем для кеша)
save ""                                 # Отключаем сохранение на диск
appendonly no                          # Отключаем AOF

# LOGGING
loglevel notice
logfile ""                             # Логи в stdout для Docker

# PERFORMANCE
databases 16
tcp-backlog 511

# SECURITY
protected-mode no                      # Для работы в Docker сети
requirepass ""                         # Пароль можно добавить через переменные окружения

# SLOW LOG
slowlog-log-slower-than 10000         # Логируем команды медленнее 10ms
slowlog-max-len 128

# LATENCY MONITORING
latency-monitor-threshold 100

# CLIENT CONNECTION
maxclients 100

# ADVANCED CONFIG
hash-max-ziplist-entries 512
hash-max-ziplist-value 64
list-max-ziplist-size -2
list-compress-depth 0
set-max-intset-entries 512
zset-max-ziplist-entries 128
zset-max-ziplist-value 64
hll-sparse-max-bytes 3000

# ACTIVE REHASHING
activerehashing yes

# CLIENT OUTPUT BUFFER LIMITS
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60

# CLIENT QUERY BUFFER LIMIT
client-query-buffer-limit 1gb

# PROTOCOL MAX BULK LENGTH
proto-max-bulk-len 512mb

# HZ FREQUENCY
hz 10

# ENABLE DYNAMIC HZ
dynamic-hz yes

# AOF REWRITE
aof-rewrite-incremental-fsync yes

# RDB CHECKSUM
rdbchecksum yes

# STOP WRITES ON BGSAVE ERROR
stop-writes-on-bgsave-error no         # Продолжаем работать даже при ошибках сохранения

# COMPRESSION
rdbcompression yes

# LUA SCRIPTING
lua-time-limit 5000

# CONFIGURATION FOR NEWS CACHING
# Специфичные настройки для кеширования новостей

# Увеличиваем таймауты для RSS парсинга
timeout 300

# Настройки для кеширования списков новостей
list-max-ziplist-size -2               # Оптимизация для списков новостей
list-compress-depth 1                  # Сжимаем элементы списков

# Настройки для кеширования хеш-структур (метаданные новостей)
hash-max-ziplist-entries 512
hash-max-ziplist-value 64

# Настройки для кеширования множеств (теги, категории)
set-max-intset-entries 512

# Настройки для отсортированных множеств (рейтинги новостей)
zset-max-ziplist-entries 128
zset-max-ziplist-value 64
